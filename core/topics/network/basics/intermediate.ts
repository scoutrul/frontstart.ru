import { Topic } from '../../../types';

export const NETWORK_BASICS_INTERMEDIATE_TOPICS: Topic[] = [
  {
    id: 'osi-model',
    title: 'Модель OSI / TCP-IP',
    difficulty: 'intermediate',
    description: 'Модель OSI и TCP/IP — иерархические модели сетевых протоколов, разделяющие коммуникацию на уровни. Каждый уровень решает свои задачи и взаимодействует с соседними. HTTP работает на прикладном уровне поверх транспортного (TCP) и сетевого (IP). Понимание уровней помогает диагностировать проблемы и оптимизировать производительность.',
    keyPoints: [
      'OSI: 7 уровней (физический, канальный, сетевой, транспортный, сеансовый, представления, прикладной).',
      'TCP/IP: 4 уровня (сетевой интерфейс, интернет, транспортный, прикладной).',
      'Прикладной уровень: HTTP, HTTPS, DNS, FTP — протоколы приложений.',
      'Транспортный уровень: TCP, UDP — доставка данных между приложениями.',
      'Сетевой уровень: IP — маршрутизация пакетов по сети.',
      'Инкапсуляция: каждый уровень добавляет свои заголовки к данным.'
    ],
    tags: ['networks', 'protocols', 'tcp-ip', 'osi', 'architecture', 'intermediate'],
    examples: [
      {
        title: 'Модель TCP/IP (4 уровня)',
        code: `// ПРИКЛАДНОЙ УРОВЕНЬ (Application)
// HTTP, HTTPS, DNS, FTP
// Данные: HTTP-запрос/ответ

// ТРАНСПОРТНЫЙ УРОВЕНЬ (Transport)
// TCP, UDP
// Добавляет: порт источника и назначения
// TCP-сегмент: [TCP заголовок] [HTTP данные]

// СЕТЕВОЙ УРОВЕНЬ (Internet)
// IP (IPv4, IPv6)
// Добавляет: IP-адреса источника и назначения
// IP-пакет: [IP заголовок] [TCP сегмент]

// УРОВЕНЬ СЕТЕВОГО ИНТЕРФЕЙСА (Network Interface)
// Ethernet, Wi-Fi
// Добавляет: MAC-адреса
// Кадр: [Ethernet заголовок] [IP пакет]`
      },
      {
        title: 'Где работает HTTP в модели',
        code: `// HTTP работает на ПРИКЛАДНОМ УРОВНЕ
// Но зависит от уровней ниже:

// HTTP → использует TCP (транспортный уровень)
// TCP → использует IP (сетевой уровень)
// IP → использует Ethernet/Wi-Fi (уровень интерфейса)

// Пример запроса:
// 1. Приложение: создаёт HTTP-запрос
// 2. TCP: разбивает на сегменты, добавляет порты
// 3. IP: добавляет IP-адреса, маршрутизирует
// 4. Ethernet: добавляет MAC-адреса, отправляет по сети`
      },
      {
        title: 'Зачем нужны уровни',
        code: `// РАЗДЕЛЕНИЕ ОТВЕТСТВЕННОСТИ:
// - Каждый уровень решает свою задачу
// - Можно менять реализацию одного уровня без влияния на другие

// ПРИМЕР:
// - HTTP не знает о маршрутизации (это задача IP)
// - TCP не знает о содержимом данных (это задача HTTP)
// - IP не знает о надёжности доставки (это задача TCP)

// ДИАГНОСТИКА:
// - Проблема с DNS → прикладной уровень
// - Проблема с соединением → транспортный уровень (TCP)
// - Проблема с маршрутизацией → сетевой уровень (IP)`
      }
    ],
    relatedTopics: ['tcp-vs-udp', 'http-basics', 'http-over-tcp']
  },
  {
    id: 'dns-caching',
    title: 'DNS-кеширование',
    difficulty: 'intermediate',
    description: 'DNS-кеширование — сохранение результатов DNS-запросов для ускорения последующих обращений. Кеширование происходит на нескольких уровнях: браузер, операционная система, DNS-сервер провайдера. TTL (Time To Live) определяет, как долго хранится запись в кеше. Понимание кеширования важно для диагностики проблем и оптимизации производительности.',
    keyPoints: [
      'Уровни кеширования: браузер → ОС → DNS-сервер провайдера → авторитативный сервер.',
      'TTL (Time To Live): время жизни записи в кеше, задаётся авторитативным сервером.',
      'Браузерный кеш: Chrome/Firefox кешируют DNS на время сессии или до перезапуска.',
      'Кеш ОС: Windows (DNS Client), Linux (systemd-resolved) кешируют на уровне системы.',
      'Кеш провайдера: рекурсивные DNS-серверы кешируют для всех клиентов.',
      'Инвалидация: изменение DNS-записей может занять время из-за кеширования.'
    ],
    tags: ['networks', 'dns', 'caching', 'performance', 'intermediate'],
    examples: [
      {
        title: 'Иерархия DNS-кеширования',
        code: `// 1. БРАУЗЕРНЫЙ КЕШ
// Chrome/Firefox кешируют DNS на время сессии
// Проверка: chrome://net-internals/#dns

// 2. КЕШ ОПЕРАЦИОННОЙ СИСТЕМЫ
// Windows: DNS Client Service
// Linux: systemd-resolved
// Команда проверки: ipconfig /displaydns (Windows)

// 3. КЕШ DNS-СЕРВЕРА ПРОВАЙДЕРА
// Рекурсивный DNS-сервер (8.8.8.8, 1.1.1.1)
// Кеширует для всех клиентов провайдера

// 4. АВТОРИТАТИВНЫЙ СЕРВЕР
// Оригинальный источник DNS-записи
// Задаёт TTL для записи`
      },
      {
        title: 'TTL (Time To Live)',
        code: `// TTL определяет время жизни записи в кеше
// Пример DNS-записи:
example.com.    A    192.0.2.1    TTL: 3600

// Это означает:
// - Запись действительна 3600 секунд (1 час)
// - Все кеши должны обновить запись через час
// - До истечения TTL используется кешированное значение

// Короткий TTL (300 сек):
// - Быстрое обновление при изменении IP
// - Больше DNS-запросов к серверу

// Длинный TTL (86400 сек = 1 день):
// - Меньше DNS-запросов
// - Медленное обновление при изменении IP`
      },
      {
        title: 'Проверка DNS-кеша',
        code: `// WINDOWS:
// Просмотр кеша ОС:
ipconfig /displaydns

// Очистка кеша ОС:
ipconfig /flushdns

// LINUX:
// Просмотр кеша systemd-resolved:
systemd-resolve --status

// Очистка кеша:
sudo systemd-resolve --flush-caches

// БРАУЗЕР:
// Chrome: chrome://net-internals/#dns
// Firefox: about:networking#dns`
      },
      {
        title: 'Проблемы с DNS-кешированием',
        code: `// ПРОБЛЕМА: Изменили IP домена, но старый IP в кеше
// РЕШЕНИЕ:
// 1. Очистить кеш браузера
// 2. Очистить кеш ОС
// 3. Подождать истечения TTL

// ПРОБЛЕМА: Медленная загрузка из-за DNS-запросов
// РЕШЕНИЕ:
// 1. Использовать короткие доменные имена
// 2. Использовать DNS-префетч (DNS-prefetch)
// 3. Использовать быстрые DNS-серверы (1.1.1.1, 8.8.8.8)`
      }
    ],
    relatedTopics: ['dns-basics', 'dns-records', 'url-navigation', 'performance-prefetch']
  },
  {
    id: 'dns-records',
    title: 'Типы DNS-записей',
    difficulty: 'intermediate',
    description: 'DNS-записи — типы данных в DNS-системе, каждый решает свою задачу. A и AAAA связывают домен с IP-адресами, CNAME создаёт алиасы, MX указывает почтовые серверы, TXT хранит текстовые данные. Понимание типов записей важно для настройки доменов, SSL-сертификатов и email.',
    keyPoints: [
      'A-запись: связывает домен с IPv4-адресом (example.com → 192.0.2.1).',
      'AAAA-запись: связывает домен с IPv6-адресом (example.com → 2001:db8::1).',
      'CNAME-запись: создаёт алиас, указывает на другой домен (www → example.com).',
      'MX-запись: указывает почтовые серверы для домена (mail → mail.example.com).',
      'TXT-запись: хранит текстовые данные (SPF, DKIM, верификация домена).',
      'NS-запись: указывает авторитативные DNS-серверы для домена.'
    ],
    tags: ['networks', 'dns', 'protocols', 'intermediate'],
    examples: [
      {
        title: 'A-запись (IPv4)',
        code: `// A-запись связывает домен с IPv4-адресом
example.com.    A    192.0.2.1

// Когда запрашивают example.com,
// DNS возвращает IP: 192.0.2.1

// Можно указать несколько A-записей для балансировки:
example.com.    A    192.0.2.1
example.com.    A    192.0.2.2
example.com.    A    192.0.2.3`
      },
      {
        title: 'AAAA-запись (IPv6)',
        code: `// AAAA-запись связывает домен с IPv6-адресом
example.com.    AAAA    2001:db8::1

// Для поддержки IPv6 нужна AAAA-запись
// Браузер выберет IPv4 или IPv6 в зависимости от доступности`
      },
      {
        title: 'CNAME-запись (алиас)',
        code: `// CNAME создаёт псевдоним для домена
www.example.com.    CNAME    example.com.
example.com.        A        192.0.2.1

// www.example.com указывает на example.com
// Оба домена ведут на один IP: 192.0.2.1

// ВАЖНО: CNAME нельзя использовать вместе с другими записями
// Нельзя: example.com CNAME other.com + example.com A 192.0.2.1`
      },
      {
        title: 'MX-запись (почта)',
        code: `// MX указывает почтовые серверы
example.com.    MX    10    mail.example.com.
mail.example.com.    A    192.0.2.10

// Приоритет: 10 (меньше = выше приоритет)
// Почта для @example.com отправляется на mail.example.com`
      },
      {
        title: 'TXT-запись (текст)',
        code: `// TXT хранит текстовые данные

// SPF (защита от спама):
example.com.    TXT    "v=spf1 include:_spf.google.com ~all"

// DKIM (подпись email):
default._domainkey.example.com.    TXT    "v=DKIM1; k=rsa; p=..."

// Верификация домена (для SSL):
example.com.    TXT    "google-site-verification=abc123..."`
      },
      {
        title: 'NS-запись (DNS-серверы)',
        code: `// NS указывает авторитативные DNS-серверы
example.com.    NS    ns1.example.com.
example.com.    NS    ns2.example.com.

// Эти серверы знают все записи для example.com
// Обычно настраивается у регистратора домена`
      }
    ],
    relatedTopics: ['dns-basics', 'dns-caching']
  }
];
