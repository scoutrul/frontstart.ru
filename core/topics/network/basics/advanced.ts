import { Topic } from '../../../types';

export const NETWORK_BASICS_ADVANCED_TOPICS: Topic[] = [
  {
    id: 'http-over-tcp',
    title: 'HTTP поверх TCP и HTTP/3',
    difficulty: 'advanced',
    description: 'HTTP/1 и HTTP/2 работают поверх TCP, который обеспечивает надёжную доставку, но имеет ограничения: head-of-line blocking и медленное установление соединения. HTTP/3 использует QUIC поверх UDP, решая эти проблемы: мультиплексирование без блокировки, быстрая установка соединения с встроенным TLS. Понимание различий важно для оптимизации производительности.',
    keyPoints: [
      'HTTP/1 и HTTP/2: работают поверх TCP, который гарантирует порядок и доставку пакетов.',
      'Проблема TCP: head-of-line blocking — потеря одного пакета блокирует все потоки.',
      'HTTP/3: использует QUIC поверх UDP, мультиплексирование на уровне протокола.',
      'QUIC: встроенный TLS 1.3, быстрая установка соединения (0-RTT для повторных подключений).',
      'Преимущества HTTP/3: нет head-of-line blocking, быстрая установка соединения, лучшая работа при потере пакетов.',
      'Обратная совместимость: HTTP/3 требует поддержки на клиенте и сервере.'
    ],
    tags: ['networks', 'http', 'tcp', 'udp', 'quic', 'http3', 'performance', 'advanced'],
    examples: [
      {
        title: 'HTTP/1 и HTTP/2 поверх TCP',
        code: `// HTTP/1.1 и HTTP/2 используют TCP:
// [HTTP данные] → [TCP сегменты] → [IP пакеты]

// TCP гарантирует:
// - Порядок пакетов
// - Доставку всех пакетов
// - Контроль перегрузки

// ПРОБЛЕМА: Head-of-Line Blocking
// Если пакет #2 потерян, пакеты #3, #4, #5 ждут
// Все потоки блокируются до получения пакета #2

// HTTP/2 решает частично:
// - Мультиплексирование нескольких запросов в одном TCP-соединении
// - Но потеря пакета всё равно блокирует все потоки`
      },
      {
        title: 'HTTP/3 и QUIC поверх UDP',
        code: `// HTTP/3 использует QUIC поверх UDP:
// [HTTP данные] → [QUIC пакеты] → [UDP] → [IP пакеты]

// QUIC решает проблемы TCP:
// 1. Мультиплексирование на уровне QUIC
//    - Потеря пакета блокирует только один поток
//    - Другие потоки продолжают работать

// 2. Встроенный TLS 1.3
//    - Шифрование на уровне QUIC
//    - Меньше round-trips при установке соединения

// 3. Быстрая установка соединения
//    - 0-RTT для повторных подключений
//    - 1-RTT для новых подключений (vs 2-3 RTT для TCP+TLS)`
      },
      {
        title: 'Head-of-Line Blocking в TCP',
        code: `// TCP: потеря пакета блокирует все потоки
// 
// Поток 1: [пакет 1] [пакет 2] [пакет 3] [пакет 4]
// Поток 2: [пакет 5] [пакет 6] [пакет 7] [пакет 8]
//
// Если пакет 2 потерян:
// - TCP ждёт повторной отправки пакета 2
// - Пакеты 3, 4, 5, 6, 7, 8 ждут в очереди
// - Все потоки заблокированы

// QUIC: потеря пакета блокирует только свой поток
//
// Поток 1: [пакет 1] [пакет 2❌] [пакет 3] [пакет 4]
// Поток 2: [пакет 5] [пакет 6] [пакет 7] [пакет 8]
//
// Если пакет 2 потерян:
// - QUIC повторяет только пакет 2
// - Пакеты 5, 6, 7, 8 продолжают обрабатываться
// - Только поток 1 заблокирован`
      },
      {
        title: 'Установка соединения: TCP+TLS vs QUIC',
        code: `// TCP + TLS (HTTP/1.1, HTTP/2):
// 1. TCP handshake: Client → Server (SYN)
//    Server → Client (SYN-ACK)
//    Client → Server (ACK)
//    = 1 RTT
//
// 2. TLS handshake: Client → Server (ClientHello)
//    Server → Client (ServerHello + Certificate)
//    Client → Server (ClientKeyExchange)
//    = 2 RTT
//
// ИТОГО: 3 RTT до первого байта данных

// QUIC (HTTP/3):
// 1. QUIC handshake с встроенным TLS:
//    Client → Server (ClientHello + данные)
//    Server → Client (ServerHello + данные)
//    = 1 RTT для нового соединения
//
// 2. Повторное соединение (0-RTT):
//    Client → Server (данные сразу, если сервер помнит)
//    = 0 RTT до первого байта данных`
      },
      {
        title: 'Когда использовать HTTP/3',
        code: `// HTTP/3 лучше работает когда:
// - Высокая потеря пакетов (мобильные сети, Wi-Fi)
// - Множество параллельных запросов
// - Важна скорость установки соединения

// HTTP/2 может быть лучше когда:
// - Стабильная сеть (низкая потеря пакетов)
// - Старые клиенты без поддержки HTTP/3
// - Простая инфраструктура без поддержки QUIC

// ПРАКТИКА:
// - Поддержка HTTP/3 растёт (Chrome, Firefox, Cloudflare, Google)
// - Можно использовать оба протокола (fallback на HTTP/2)`
      }
    ],
    relatedTopics: ['http-versions', 'tcp-vs-udp', 'osi-model']
  }
];
