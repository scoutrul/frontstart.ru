import { Topic } from '../../../types';

export const NPM_INTERMEDIATE_TOPICS: Topic[] = [
  {
    id: 'dependencies-node-modules',
    title: 'Зависимости и node_modules',
    difficulty: 'intermediate',
    description: 'Зависимости проекта разделяются на dependencies и devDependencies. Папка node_modules генерируется автоматически при установке пакетов и содержит все установленные библиотеки. node_modules не коммитится в Git, так как может быть воссоздана через npm install.',
    keyPoints: [
      'Что это: структура зависимостей проекта и их хранение',
      'dependencies: пакеты, нужные для работы приложения в продакшене',
      'devDependencies: пакеты, нужные только для разработки (линтеры, тесты, сборщики)',
      'node_modules: папка с установленными пакетами, генерируется автоматически',
      'node_modules не коммитится в Git',
      'npm install создает node_modules на основе package.json',
      '.gitignore должен содержать node_modules'
    ],
    additionalDescription: 'Разделение на dependencies и devDependencies важно для оптимизации продакшен-сборок: dev-зависимости не попадают в финальный бандл, что уменьшает его размер.',
    tags: ['tools', 'npm', 'package-manager', 'dependencies', 'node-modules'],
    relatedTopics: ['npm-basics'],
    examples: [
      {
        title: 'package.json с зависимостями',
        code: `{
  "dependencies": {
    "react": "^18.2.0",
    "express": "^4.18.0"
  },
  "devDependencies": {
    "eslint": "^8.0.0",
    "jest": "^29.0.0"
  }
}`
      }
    ]
  },
  {
    id: 'lock-files',
    title: 'Lock-файлы',
    difficulty: 'intermediate',
    description: 'Lock-файлы фиксируют точные версии всех зависимостей проекта, включая транзитивные. package-lock.json гарантирует, что все разработчики и CI/CD получат одинаковые версии пакетов. npm ci использует lock-файл для чистой установки.',
    keyPoints: [
      'Что это: файлы, фиксирующие точные версии всех зависимостей',
      'package-lock.json фиксирует точные версии всех зависимостей, включая транзитивные',
      'npm ci использует lock-файл для чистой установки (быстрее и надежнее)',
      'Lock-файлы коммитятся в репозиторий для воспроизводимых сборок',
      'Гарантирует одинаковые версии пакетов у всех разработчиков',
      'Важно для CI/CD и предотвращения проблем с версиями'
    ],
    additionalDescription: 'Lock-файлы критически важны для командной разработки и CI/CD, так как гарантируют, что все окружения используют одинаковые версии зависимостей, что предотвращает проблемы "у меня работает, а у тебя нет".',
    tags: ['tools', 'npm', 'package-manager', 'lock-files', 'versioning'],
    relatedTopics: ['dependencies-node-modules'],
    examples: [
      {
        title: 'Использование lock-файла',
        code: `npm install        // создает/обновляет package-lock.json
npm ci            // чистая установка из lock-файла (удаляет node_modules)
// npm ci быстрее и надежнее для CI/CD`
      }
    ]
  },
  {
    id: 'version-ranges',
    title: 'Диапазоны версий и обновления',
    difficulty: 'intermediate',
    description: 'В package.json используются символы для указания диапазонов версий: ^ позволяет обновления до следующей минорной версии, ~ только патчи, точная версия фиксирует полностью. npm outdated показывает устаревшие пакеты, npm update обновляет в пределах диапазона.',
    keyPoints: [
      'Что это: символы для указания диапазонов версий в package.json',
      '^4.18.0: обновление до следующей минорной версии (4.x → 5.0.0 не включительно)',
      '~4.18.0: обновление только патчей (4.18.x)',
      'Точные версии фиксируют полностью (4.18.0)',
      'npm outdated показывает устаревшие пакеты',
      'npm update обновляет пакеты в пределах диапазона версий',
      'Semver: семантическое версионирование (major.minor.patch)'
    ],
    additionalDescription: 'Понимание диапазонов версий важно для баланса между стабильностью и получением обновлений. ^ обычно используется для зависимостей, так как минорные обновления должны быть обратно совместимы.',
    tags: ['tools', 'npm', 'package-manager', 'versioning', 'semver'],
    relatedTopics: ['npm-basics', 'lock-files'],
    examples: [
      {
        title: 'Диапазоны версий',
        code: `"dependencies": {
  "express": "^4.18.0",  // 4.18.0 до 5.0.0 (не включительно)
  "lodash": "~4.17.21",  // 4.17.21 до 4.18.0 (не включительно)
  "react": "18.2.0"      // точная версия
}

npm outdated    // показать устаревшие пакеты
npm update      // обновить в пределах диапазона`
      }
    ]
  },
  {
    id: 'npm-alternatives',
    title: 'Yarn, PNPM и Bun',
    difficulty: 'intermediate',
    description: 'Yarn, PNPM и Bun — популярные альтернативы npm с улучшенной производительностью и оптимизацией. PNPM использует ссылочную структуру node_modules, экономя место и ускоряя установку. Bun — современный быстрый пакетный менеджер и runtime, написанный на Zig. Разные подходы к резолвингу зависимостей могут влиять на размер бандла и CI/CD.',
    keyPoints: [
      'Что это: альтернативные пакетные менеджеры с улучшенной производительностью',
      'Yarn и PNPM — популярные альтернативы npm',
      'Bun: современный быстрый пакетный менеджер и runtime, написанный на Zig',
      'PNPM использует ссылочную node_modules, экономя место и ускоряя установку',
      'Bun использует нативный код и оптимизированные алгоритмы для максимальной скорости',
      'Разделение prod и dev зависимостей аналогично npm',
      'Разные подходы к резолвингу перекрестных зависимостей',
      'Кэширование пакетов повышает скорость установки',
      'Выбор пакетного менеджера может влиять на размер бандла и CI/CD'
    ],
    additionalDescription: 'Yarn был создан Facebook в 2016 году для решения проблем производительности npm. PNPM появился позже и использует симлинки для более эффективного хранения пакетов. Bun был запущен в 2022 году и позиционируется как замена Node.js и пакетных менеджеров с фокусом на скорость. Все менеджеры совместимы с package.json и могут использоваться в одних и тех же проектах.',
    funFact: 'Помимо популярных менеджеров существуют и другие: Rush от Microsoft для монорепозиториев, Volta для управления версиями, jspm для ES Modules. Они реже используются в обычной разработке, но находят применение в корпоративных проектах.',
    tags: ['tools', 'npm', 'yarn', 'pnpm', 'bun', 'package-manager', 'performance'],
    relatedTopics: ['npm-basics', 'dependencies-node-modules'],
    examples: [
      {
        title: 'Команды пакетных менеджеров',
        code: `// Команды одинаковые для всех менеджеров, меняется только префикс
// Yarn, PNPM и Bun поддерживают сокращения (i вместо install)
// npm требует полного написания команды install

// Yarn
yarn install    // или yarn i
yarn add react  // добавление пакета
yarn remove react  // удаление пакета

// PNPM
pnpm install   // или pnpm i
pnpm add react  // добавление пакета
pnpm remove react  // удаление пакета

// Bun
bun install    // или bun i
bun add react   // добавление пакета
bun remove react  // удаление пакета
bun run dev     // запуск скрипта

// npm
npm install     // нужно писать полностью, сокращение не работает`
      }
    ]
  }
];
